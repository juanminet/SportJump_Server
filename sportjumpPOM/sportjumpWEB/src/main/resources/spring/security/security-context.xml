<?xml version="1.0" encoding="UTF-8"?>

<beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:security="http://www.springframework.org/schema/security"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.springframework.org/schema/beans 
        http://www.springframework.org/schema/beans/spring-beans-3.1.xsd
        http://www.springframework.org/schema/security 
        http://www.springframework.org/schema/security/spring-security-3.1.xsd">
        
    
  	<!-- 	<security:user-service id="security-user-service">
		<security:user name="juanmi" password="juanmi" authorities="ROLE_USER"/>	
		<security:user name="admin" password="admin" authorities="ROLE_ADMIN" />				
	</security:user-service> 
	
	<security:authentication-manager alias="authenticationManager">	
		<security:authentication-provider user-service-ref="security-user-service" />		
	</security:authentication-manager>
	-->
	
	
	
	<!-- Property Configurator -->
	<bean id="propertyPlaceholderConfigurer" class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">
	   		<property name="locations">
	   			<list>
	   				<value>classpath:spring/security/auth_config.properties</value>
	   			</list>
	   		</property>
	   		
	</bean> 
	<!-- Data -->	
	
 	<bean id="dataSource" class="org.apache.commons.dbcp.BasicDataSource" destroy-method="close">
	    <property name="driverClassName" value="${database.auth.driver.class.name}"/>
	    <property name="url" value="${database.auth.url}"/>
	    <property name="username" value="${database.auth.username}"/>
	    <property name="password" value="${database.auth.password}"/>
	</bean>
	
 	
	
    <bean id="userDetailsManager" class="org.springframework.security.provisioning.JdbcUserDetailsManager">
   		<property name="dataSource" ref="dataSource"></property>
   		<property name="authenticationManager" ref="authenticationManager"></property>
    </bean> 
    
    <bean id="passwordEncoder" class="org.springframework.security.authentication.encoding.ShaPasswordEncoder"></bean>
    
    <bean id="saltSource" class="org.springframework.security.authentication.dao.ReflectionSaltSource">
   		<property name="userPropertyToUse" value="username"></property>
	</bean>
	
	 <!-- End Data -->
	
    

	<security:authentication-manager alias="authenticationManager">	
		<security:authentication-provider user-service-ref="userDetailsManager">
		    <security:password-encoder ref="passwordEncoder">
		        <security:salt-source ref="saltSource"/>
      		</security:password-encoder>
      </security:authentication-provider>		
	</security:authentication-manager>        
        
	

	
	
	
	<security:http auto-config="true" use-expressions="true">		
		
				
		<security:intercept-url pattern="/test" access="permitAll" />	 
		<security:intercept-url pattern="/login" access="permitAll"/>
		<security:intercept-url pattern="/registration" access="permitAll"/>
		<security:intercept-url pattern="/resources/**/*" access="permitAll"/>
		
		<security:intercept-url pattern="/*" access="hasAnyRole('ROLE_ADMIN','ROLE_USER')"/>
	 	<security:intercept-url pattern="/action/**/*" access="hasAnyRole('ROLE_ADMIN','ROLE_USER')"/>
	 	<security:intercept-url pattern="/rest/**/*" access="hasAnyRole('ROLE_ADMIN','ROLE_USER', 'ROLE_EXTERN')"/>
	 	<security:intercept-url pattern="/login/**/*" access="hasAnyRole('ROLE_ADMIN','ROLE_USER')"/>
		<security:intercept-url pattern="/**/*" access="hasRole('ROLE_ADMIN')"/> 
		
		<security:form-login login-page="/login" authentication-failure-url="/login?login_error=1" default-target-url="/login/success" always-use-default-target="true"/>
		<security:logout invalidate-session="true" logout-url="/logout"/>		
	</security:http>

	<!-- <security:global-method-security secured-annotations="enabled" />  -->
	<!--  SECURITY -->
 	<!-- <security:http auto-config='true' use-expressions="true">	 
	 	<security:logout logout-url="/static/j_spring_security_logout"/>	 
 		<security:intercept-url pattern="/action/test" access="hasRole('ROLE_USER')" /> 
 		<security:intercept-url pattern="/action/rest/**" access="permitAll" requires-channel="https"/> 
 		<security:intercept-url pattern="/admin/**" access="hasRole('ROLE_ADMIN')" />  -->
	<!-- <security:intercept-url pattern="/spring_security_login"  requires-channel="https"/> 
  		 -->
  		
	<!--  </security:http> -->
	

 
	
</beans>